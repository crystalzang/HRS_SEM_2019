---
title: "rand"
author: "CZ"
date: "3/25/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(readr)
library(haven)
library(data.table)
library(ggplot2)
library(mosaic)
library(skimr)
#functions
'%ni%' <- Negate('%in%')
```

```{r}
rand <- read_csv("~/Desktop/data/randhrs.csv")

#glimpse(rand)
```


#Extract variables and Data Exploration
R12... or S12... indicates 12 wave, which is from 2014. 
```{r}
id <- rand %>%
  select(HHIDPN, HHID, PN, RAHHIDPN,
          R12CESD, S12CESD, #CESD Score, binary level yes or no
         
          R12ADLA, S12ADLA #ADL Summary: sum ADLs where Respondent reports any difficulty
        )

skim(id)
#rename
setnames(id ,
         old=c("R12ADLA", "S12ADLA", "R12CESD", "S12CESD"),
         new = c("R_ADL", "S_ADL", "R_CESD", "S_CESD"))

#filter out non-dyad individuals
id_valid <- id%>%
  filter(!is.na(R_ADL), !is.na(S_ADL), !is.na(R_CESD), !is.na(S_CESD))

#There shouldn't be any missing R_ADL
tally(id_valid$S_ADL)

#Missing S_ADL meaning that those helper don't have ADL
tally(id_valid$S_ADL)

#There shouldn't be any missing R_CESD, we want all informaiton
tally(id_valid$R_CESD)

#There shouldn't be any missing S_CESD, we want all informaiton
tally(id_valid$S_CESD)
```

#Couple Investigation
```{r}
#check couple
id_group<-id_valid%>%
  group_by(HHID)%>%
  summarize(N=n())

#Only 2 is reasonable
tally(id_group$N)

#Valid dyad HHID 
id_valid_dyad_id <- id_group%>%
  filter(N==2)%>%
  select(HHID)%>%
  mutate(dyad = "Y")

#Cleaned dyad data
id_valid_dyad <- left_join(id_valid, id_valid_dyad_id, by="HHID")%>%
  filter(dyad == "Y")

#write.csv(id_valid_dyad, file="rand_dyad.csv", row.names = F)
```

# Helper READ IN
```{r eval=FALSE, include=FALSE}
#year: 2016

helper <- read_sav("/Users/crystalzang/Desktop/data/helper/H14G_HP.sav", encoding = NULL, user_na = FALSE)%>%
  filter(!is.na(OPN_SP))%>%
  filter(OPN_SP %ni% c("","811", "812", "821", "831", "832", "841", "822"))%>%
  mutate(respondent_id= paste(HHID, PN, sep=""), spouse_id=paste(HHID, OPN_SP, sep=""))%>%
  filter(OG069 == "2")

helper_id <- helper%>%
  select(respondent_id, spouse_id, OG069, OG070) %>% #OG069:Relation. OG070:Frequency help
  mutate(helper="Y")
```

# Create sub-dataset by helper status
```{r}
#Join helper with spouse in RAND, indicating spouses who are helpers
spouse_helper <- left_join(id_valid_dyad, helper_id, by= c("RAHHIDPN"= "respondent_id"))%>%
  filter(helper=="Y")%>%
  select(RAHHIDPN)%>%
  mutate(helper_status = "spouse helper")


#Join helper with respondent in RAND, indicating respondents who are helpers
class(id_valid_dyad$HHIDPN)
class(helper_id$respondent_id)
id_valid_dyad$HHIDPN<-as.character(id_valid_dyad$HHIDPN)

respondent_helper <- left_join(id_valid_dyad, helper_id, by= c("HHIDPN"= "respondent_id"))%>%
  filter(helper=="Y")%>%
  select(HHIDPN)%>%
  mutate(helper_status = "respondent helper")


#both_helper <- setdiff(spouse_helper$RAHHIDPN,respondent_helper$HHIDPN)%>%
#  as.data.frame(col.names = names(respondent_helper))
#Helpers who are both respondent and helpers
both_helper <-inner_join(spouse_helper, respondent_helper, by = c("RAHHIDPN"= "HHIDPN"))%>%
  mutate(helper_status = "both helper")%>%
  select(RAHHIDPN, helper_status)

```


```{r}
dyad_type1_both_helper <- inner_join(id_valid_dyad, both_helper, by = "RAHHIDPN")
```

